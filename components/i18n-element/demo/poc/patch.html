<!--
@license https://github.com/t2ym/i18n-element/blob/master/LICENSE.md
Copyright (c) 2018, Tetsuya Mori <t2y3141592@gmail.com>. All rights reserved.
-->
<script>
  (async function () {
    let url = location.pathname.replace(/patch[.]html$/, '');
    if ('serviceWorker' in navigator) {
      try {
        let registration = await navigator.serviceWorker.register('../../../../../patch-sw.js', { scope: '../../../../../' });
        let serviceWorker = registration.active || registration.waiting || registration.installing;
        if (serviceWorker) {
          if (ServiceWorker.state !== 'activated') {
            serviceWorker.addEventListener('statechange', function onStateChange (e) {
              switch (e.target.state) {
              case 'activated':
                window.location = url;
                break;
              default:
                break;
              }
            });
          }
          else {
            window.location = url;
          }
        }
        else {
          //setTimeout(function() { window.location.reload(); }, 1000);
        }
      }
      catch (e) {
      }
      finally {
        window.location = url;
      }
    }
    else {
      window.location = url;
    }    
  })();      
</script>
